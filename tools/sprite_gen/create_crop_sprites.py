#!/usr/bin/env python3
"""Create hand-crafted 16x16 pixel-art crop sprites and generate crops.png.

Atlas layout (64x64, 4 columns x 4 rows of 16x16 tiles):
  Columns: Wheat(0), Carrot(1), Potato(2), Melon(3)
  Rows:    Seedling(0), Sprout(1), Vegetative(2), Mature(3)

Frame index = cropType + stage * 4
This matches CropSprite.setFrame() in the game code.
"""

import os
from PIL import Image

SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
PROJECT_ROOT = os.path.join(SCRIPT_DIR, "..", "..")
ASSETS_DIR = os.path.join(PROJECT_ROOT, "app", "src", "main", "assets")
CROPS_PNG = os.path.join(ASSETS_DIR, "crops.png")
OUTPUT_DIR = os.path.join(SCRIPT_DIR, "output")

TILE_SIZE = 16
COLS = 4  # Crop types: Wheat, Carrot, Potato, Melon
ROWS = 4  # Growth stages: Seedling, Sprout, Vegetative, Mature

_ = 0  # Transparent

# ============================================================
# Each sprite: (name, col, row, palette, 16x16 grid)
#   col = crop type (0=wheat, 1=carrot, 2=potato, 3=melon)
#   row = growth stage (0=seedling, 1=sprout, 2=vegetative, 3=mature)
#   palette maps int keys (1,2,3...) to RGBA tuples
#   0 is always transparent
# ============================================================

# ============================================================
# WHEAT - thin stalks, golden grain ears when mature
# ============================================================

WHEAT_SEEDLING = (
    "wheat_seedling", 0, 0,
    {1: (35, 28, 12, 255),     # outline/root
     2: (60, 130, 40, 255),    # green base
     3: (90, 170, 60, 255)},   # green highlight
    # Tiny sprout with two cotyledon leaves
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,3,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,2,3,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

WHEAT_SPROUT = (
    "wheat_sprout", 0, 1,
    {1: (35, 28, 12, 255),
     2: (60, 130, 40, 255),
     3: (90, 170, 60, 255),
     4: (42, 95, 28, 255)},
    # Two thin stalks with small leaf blades
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,3,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,2,_,3,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,3,2,_,_,_,_,_,_],
        [_,_,_,_,_,3,_,2,_,2,_,_,_,_,_,_],
        [_,_,_,_,_,_,2,2,_,2,3,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,_,2,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,4,_,4,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,_,1,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

WHEAT_VEGETATIVE = (
    "wheat_vegetative", 0, 2,
    {1: (35, 28, 12, 255),
     2: (60, 130, 40, 255),
     3: (90, 170, 60, 255),
     4: (42, 95, 28, 255)},
    # Three tall green stalks with alternating leaf blades
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,_,_,3,_,_,_,_,_,_],
        [_,_,_,_,_,3,2,3,3,2,3,_,_,_,_,_],
        [_,_,_,_,_,_,2,_,_,2,_,_,_,_,_,_],
        [_,_,_,_,3,_,2,_,_,2,_,3,_,_,_,_],
        [_,_,_,_,_,3,2,_,_,2,3,_,_,_,_,_],
        [_,_,_,_,_,_,2,3,3,2,_,_,_,_,_,_],
        [_,_,_,_,_,3,2,_,_,2,3,_,_,_,_,_],
        [_,_,_,_,_,_,2,_,_,2,_,_,_,_,_,_],
        [_,_,_,_,_,_,4,_,_,4,_,_,_,_,_,_],
        [_,_,_,_,_,_,1,_,_,1,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

WHEAT_MATURE = (
    "wheat_mature", 0, 3,
    {1: (50, 35, 10, 255),       # outline
     2: (210, 180, 50, 255),     # golden base
     3: (240, 215, 80, 255),     # golden highlight
     4: (170, 140, 35, 255),     # golden shadow
     5: (55, 115, 35, 255),      # green stem
     6: (80, 150, 50, 255)},     # green leaf highlight
    # Tall golden wheat with drooping grain ears at top
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,3,3,_,3,3,_,_,_,_,_,_],
        [_,_,_,_,3,2,2,_,2,2,3,_,_,_,_,_],
        [_,_,_,_,4,2,4,_,4,2,4,_,_,_,_,_],
        [_,_,_,_,_,1,_,_,_,1,_,_,_,_,_,_],
        [_,_,_,_,_,5,_,_,_,5,_,_,_,_,_,_],
        [_,_,_,_,6,5,_,_,_,5,6,_,_,_,_,_],
        [_,_,_,_,_,5,_,_,_,5,_,_,_,_,_,_],
        [_,_,_,_,_,5,6,_,6,5,_,_,_,_,_,_],
        [_,_,_,_,6,5,_,_,_,5,6,_,_,_,_,_],
        [_,_,_,_,_,5,_,_,_,5,_,_,_,_,_,_],
        [_,_,_,_,_,1,_,_,_,1,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

# ============================================================
# CARROT - feathery green tops, orange root when mature
# ============================================================

CARROT_SEEDLING = (
    "carrot_seedling", 1, 0,
    {1: (25, 35, 15, 255),     # outline
     2: (50, 135, 40, 255),    # green base
     3: (80, 170, 55, 255)},   # green highlight
    # Tiny feathery sprout
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,3,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,_,3,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

CARROT_SPROUT = (
    "carrot_sprout", 1, 1,
    {1: (25, 35, 15, 255),
     2: (50, 135, 40, 255),
     3: (80, 170, 55, 255),
     4: (35, 100, 28, 255)},
    # Feathery green top, thin strands
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,_,_,3,_,_,_,_,_,_],
        [_,_,_,_,_,3,_,3,3,_,3,_,_,_,_,_],
        [_,_,_,_,_,_,3,2,2,3,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,2,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,2,2,3,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,2,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,4,4,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

CARROT_VEGETATIVE = (
    "carrot_vegetative", 1, 2,
    {1: (25, 35, 15, 255),
     2: (50, 135, 40, 255),
     3: (80, 170, 55, 255),
     4: (35, 100, 28, 255),
     5: (220, 130, 30, 255)},  # orange hint
    # Bushy feathery top, hint of orange below
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,3,_,3,3,_,3,_,_,_,_,_],
        [_,_,_,_,3,_,3,2,2,3,_,3,_,_,_,_],
        [_,_,_,_,_,3,2,2,2,2,3,_,_,_,_,_],
        [_,_,_,_,3,_,2,3,3,2,_,3,_,_,_,_],
        [_,_,_,_,_,3,2,2,2,2,3,_,_,_,_,_],
        [_,_,_,_,_,_,2,2,2,2,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,2,2,3,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,4,4,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,5,5,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

CARROT_MATURE = (
    "carrot_mature", 1, 3,
    {1: (25, 35, 15, 255),       # outline
     2: (50, 135, 40, 255),      # green base
     3: (80, 170, 55, 255),      # green highlight
     4: (35, 100, 28, 255),      # green shadow
     5: (230, 140, 35, 255),     # orange base
     6: (250, 175, 55, 255),     # orange highlight
     7: (185, 100, 20, 255)},    # orange shadow
    # Full feathery top with orange carrot visible below
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,3,_,3,_,_,3,_,3,_,_,_,_],
        [_,_,_,3,_,3,2,3,3,2,3,_,3,_,_,_],
        [_,_,_,_,3,2,2,2,2,2,2,3,_,_,_,_],
        [_,_,_,_,3,2,3,2,2,3,2,3,_,_,_,_],
        [_,_,_,_,_,3,2,2,2,2,3,_,_,_,_,_],
        [_,_,_,_,_,_,2,3,3,2,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,4,4,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,6,5,5,6,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,5,5,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,7,7,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

# ============================================================
# POTATO - broad leafy bush, purple flowers when mature
# ============================================================

POTATO_SEEDLING = (
    "potato_seedling", 2, 0,
    {1: (25, 30, 15, 255),     # outline
     2: (50, 115, 38, 255),    # green base
     3: (78, 150, 52, 255)},   # green highlight
    # Tiny broad-leaf sprout
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,3,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,2,3,_,_,_,_,_,_,_],
        [_,_,_,_,_,3,2,2,2,3,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

POTATO_SPROUT = (
    "potato_sprout", 2, 1,
    {1: (25, 30, 15, 255),
     2: (50, 115, 38, 255),
     3: (78, 150, 52, 255),
     4: (38, 85, 26, 255)},
    # Small bush with broad leaves
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,3,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,2,3,_,_,_,_,_,_,_],
        [_,_,_,_,_,3,2,2,2,3,_,_,_,_,_,_],
        [_,_,_,_,_,2,3,2,3,2,_,_,_,_,_,_],
        [_,_,_,_,3,2,2,2,2,2,3,_,_,_,_,_],
        [_,_,_,_,_,2,2,4,2,2,_,_,_,_,_,_],
        [_,_,_,_,_,_,4,2,4,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

POTATO_VEGETATIVE = (
    "potato_vegetative", 2, 2,
    {1: (25, 30, 15, 255),
     2: (50, 115, 38, 255),
     3: (78, 150, 52, 255),
     4: (38, 85, 26, 255)},
    # Medium bushy plant with broad leaves
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,_,_,3,_,_,_,_,_,_],
        [_,_,_,_,_,3,2,3,3,2,3,_,_,_,_,_],
        [_,_,_,_,3,2,2,2,2,2,2,3,_,_,_,_],
        [_,_,_,_,2,3,2,3,3,2,3,2,_,_,_,_],
        [_,_,_,3,2,2,3,2,2,3,2,2,3,_,_,_],
        [_,_,_,_,2,2,2,2,2,2,2,2,_,_,_,_],
        [_,_,_,_,_,2,2,4,4,2,2,_,_,_,_,_],
        [_,_,_,_,_,4,2,2,2,2,4,_,_,_,_,_],
        [_,_,_,_,_,_,4,4,4,4,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

POTATO_MATURE = (
    "potato_mature", 2, 3,
    {1: (25, 30, 15, 255),       # outline
     2: (50, 115, 38, 255),      # green base
     3: (78, 150, 52, 255),      # green highlight
     4: (38, 85, 26, 255),       # green shadow
     5: (190, 160, 215, 255),    # flower purple light
     6: (150, 120, 180, 255),    # flower purple dark
     7: (240, 220, 80, 255)},    # flower center yellow
    # Full bush with small purple flowers on top
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,5,_,_,_,_,5,_,_,_,_,_],
        [_,_,_,_,5,7,5,_,_,5,7,5,_,_,_,_],
        [_,_,_,_,_,6,_,3,3,_,6,_,_,_,_,_],
        [_,_,_,_,3,2,3,2,2,3,2,3,_,_,_,_],
        [_,_,_,3,2,3,2,3,3,2,3,2,3,_,_,_],
        [_,_,_,2,2,2,3,2,2,3,2,2,2,_,_,_],
        [_,_,_,_,2,2,2,2,2,2,2,2,_,_,_,_],
        [_,_,_,_,3,2,2,4,4,2,2,3,_,_,_,_],
        [_,_,_,_,_,2,4,2,2,4,2,_,_,_,_,_],
        [_,_,_,_,_,_,4,4,4,4,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

# ============================================================
# MELON - spreading vine, large round fruit when mature
# ============================================================

MELON_SEEDLING = (
    "melon_seedling", 3, 0,
    {1: (15, 35, 12, 255),     # outline
     2: (45, 125, 35, 255),    # green base
     3: (75, 165, 50, 255)},   # green highlight
    # Tiny vine sprout with two round leaves
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,3,3,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,3,2,2,3,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,2,2,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

MELON_SPROUT = (
    "melon_sprout", 3, 1,
    {1: (15, 35, 12, 255),
     2: (45, 125, 35, 255),
     3: (75, 165, 50, 255),
     4: (32, 90, 24, 255)},
    # Vine with a couple of round leaves
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,3,3,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,3,2,2,3,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,2,2,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,2,_,_,3,3,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,3,2,2,3,_,_,_,_],
        [_,_,_,_,_,_,_,_,2,2,2,_,_,_,_,_],
        [_,_,_,_,_,_,_,4,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

MELON_VEGETATIVE = (
    "melon_vegetative", 3, 2,
    {1: (15, 35, 12, 255),
     2: (45, 125, 35, 255),
     3: (75, 165, 50, 255),
     4: (32, 90, 24, 255),
     5: (80, 155, 55, 255)},   # light green (small fruit hint)
    # Spreading vine with leaves and tiny green bump
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,3,3,_,_,_,_,3,3,_,_,_,_],
        [_,_,_,3,2,2,3,_,_,3,2,2,3,_,_,_],
        [_,_,_,_,2,2,_,_,_,_,2,2,_,_,_,_],
        [_,_,_,_,_,2,_,_,_,_,2,_,_,_,_,_],
        [_,_,_,_,_,_,2,_,_,2,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,2,2,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,5,5,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,5,4,4,5,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,4,4,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

MELON_MATURE = (
    "melon_mature", 3, 3,
    {1: (15, 35, 12, 255),       # outline
     2: (45, 125, 35, 255),      # vine green
     3: (75, 165, 50, 255),      # leaf highlight
     4: (60, 140, 42, 255),      # melon light green
     5: (40, 105, 30, 255),      # melon dark stripe
     6: (85, 175, 60, 255),      # melon highlight
     7: (32, 80, 22, 255)},      # melon shadow
    # Large round melon with vine tendril and leaf
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,3,3,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,3,2,2,3,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,2,2,_,2,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,1,1,1,1,1,_,_,_,_,_],
        [_,_,_,_,_,1,6,4,5,4,6,1,_,_,_,_],
        [_,_,_,_,1,6,4,5,4,5,4,6,1,_,_,_],
        [_,_,_,_,1,4,5,4,5,4,5,4,1,_,_,_],
        [_,_,_,_,1,4,4,5,4,5,4,4,1,_,_,_],
        [_,_,_,_,1,7,4,5,4,5,4,7,1,_,_,_],
        [_,_,_,_,_,1,7,4,4,4,7,1,_,_,_,_],
        [_,_,_,_,_,_,1,1,1,1,1,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

# ============================================================
# All sprites in order
# ============================================================

ALL_CROPS = [
    # Row 0 (seedlings)
    WHEAT_SEEDLING, CARROT_SEEDLING, POTATO_SEEDLING, MELON_SEEDLING,
    # Row 1 (sprouts)
    WHEAT_SPROUT, CARROT_SPROUT, POTATO_SPROUT, MELON_SPROUT,
    # Row 2 (vegetative)
    WHEAT_VEGETATIVE, CARROT_VEGETATIVE, POTATO_VEGETATIVE, MELON_VEGETATIVE,
    # Row 3 (mature)
    WHEAT_MATURE, CARROT_MATURE, POTATO_MATURE, MELON_MATURE,
]


def create_sprite(palette, grid):
    """Render a 16x16 pixel-art sprite from a palette-indexed grid."""
    img = Image.new("RGBA", (TILE_SIZE, TILE_SIZE), (0, 0, 0, 0))
    pixels = img.load()
    for y, row in enumerate(grid):
        for x, val in enumerate(row):
            if val != 0 and val in palette:
                pixels[x, y] = palette[val]
    return img


def main():
    os.makedirs(OUTPUT_DIR, exist_ok=True)

    # Create the atlas image (4 cols x 4 rows of 16x16 tiles = 64x64)
    atlas_w = COLS * TILE_SIZE   # 64
    atlas_h = ROWS * TILE_SIZE   # 64
    atlas = Image.new("RGBA", (atlas_w, atlas_h), (0, 0, 0, 0))

    for name, col, row, palette, grid in ALL_CROPS:
        sprite = create_sprite(palette, grid)

        # Save individual sprite
        out_path = os.path.join(OUTPUT_DIR, f"{name}.png")
        sprite.save(out_path)
        print(f"  Created {out_path}")

        # Place in atlas at (col, row)
        ax = col * TILE_SIZE
        ay = row * TILE_SIZE
        atlas.paste(sprite, (ax, ay))
        print(f"  Placed {name} at col={col}, row={row} (x={ax}, y={ay})")

    # Save the atlas
    atlas.save(CROPS_PNG)
    print(f"\n  Saved crops.png: {atlas_w}x{atlas_h} -> {CROPS_PNG}")


if __name__ == "__main__":
    main()
