#!/usr/bin/env python3
"""Create hand-crafted 16x16 pixel-art food sprites and extend items.png."""

import os
from PIL import Image

SCRIPT_DIR = os.path.dirname(os.path.abspath(__file__))
PROJECT_ROOT = os.path.join(SCRIPT_DIR, "..", "..")
ITEMS_PNG = os.path.join(PROJECT_ROOT, "app", "src", "main", "assets", "items.png")
OUTPUT_DIR = os.path.join(SCRIPT_DIR, "output")

TILE_SIZE = 16
COLS = 8  # items.png is 128px wide = 8 columns of 16px

# -- Transparent alias --
_ = 0

# ============================================================
# Each sprite: (name, index, palette dict, 16x16 grid)
#   palette maps int keys (1,2,3...) to RGBA tuples
#   0 is always transparent
# ============================================================

STALE_RATION = (
    "stale_ration", 128,
    {1: (50, 40, 30, 255),    # dark outline
     2: (139, 119, 91, 255),  # base cloth brown
     3: (110, 90, 65, 255),   # shadow brown
     4: (165, 145, 115, 255), # highlight brown
     5: (90, 70, 50, 255)},   # tie/knot dark
    # Wrapped bundle tied at top
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,1,5,5,1,_,_,_,_,_,_],
        [_,_,_,_,_,1,5,2,2,5,1,_,_,_,_,_],
        [_,_,_,_,1,1,1,1,1,1,1,1,_,_,_,_],
        [_,_,_,1,4,4,2,2,2,2,3,3,1,_,_,_],
        [_,_,1,4,4,2,2,2,2,2,2,3,3,1,_,_],
        [_,_,1,4,2,2,2,2,2,2,2,2,3,1,_,_],
        [_,_,1,4,2,2,2,2,2,2,2,3,3,1,_,_],
        [_,_,1,2,2,2,3,2,2,3,2,2,3,1,_,_],
        [_,_,1,2,2,3,3,2,2,3,3,2,3,1,_,_],
        [_,_,_,1,2,3,2,2,2,2,3,2,1,_,_,_],
        [_,_,_,_,1,1,1,1,1,1,1,1,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

APPLE = (
    "apple", 129,
    {1: (50, 20, 20, 255),    # dark outline
     2: (200, 50, 50, 255),   # base red
     3: (160, 30, 30, 255),   # shadow red
     4: (230, 90, 80, 255),   # highlight red
     5: (255, 180, 170, 255), # specular
     6: (80, 50, 30, 255),    # stem brown
     7: (60, 140, 40, 255)},  # leaf green
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,6,6,1,7,7,_,_,_,_],
        [_,_,_,_,_,1,1,1,6,1,7,7,1,_,_,_],
        [_,_,_,_,1,4,4,2,1,2,2,3,3,1,_,_],
        [_,_,_,1,4,5,4,2,2,2,2,2,3,1,_,_],
        [_,_,_,1,4,4,2,2,2,2,2,2,3,1,_,_],
        [_,_,_,1,2,2,2,2,2,2,2,3,3,1,_,_],
        [_,_,_,1,2,2,2,2,2,2,2,3,3,1,_,_],
        [_,_,_,1,2,2,2,2,2,2,3,3,3,1,_,_],
        [_,_,_,_,1,2,2,2,2,2,3,3,1,_,_,_],
        [_,_,_,_,_,1,1,1,1,1,1,1,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

CHEESE_WEDGE = (
    "cheese_wedge", 130,
    {1: (80, 60, 10, 255),    # dark outline
     2: (230, 200, 50, 255),  # base yellow
     3: (190, 160, 30, 255),  # shadow yellow
     4: (250, 230, 100, 255), # highlight yellow
     5: (170, 140, 20, 255),  # hole dark
     6: (210, 180, 40, 255)}, # hole mid
    # Triangular wedge with holes
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,1,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,1,4,1,_,_],
        [_,_,_,_,_,_,_,_,_,_,1,4,2,1,_,_],
        [_,_,_,_,_,_,_,_,_,1,4,2,2,1,_,_],
        [_,_,_,_,_,_,_,_,1,4,2,5,2,1,_,_],
        [_,_,_,_,_,_,_,1,4,2,2,6,2,1,_,_],
        [_,_,_,_,_,_,1,4,2,2,5,2,3,1,_,_],
        [_,_,_,_,_,1,4,2,5,2,6,2,3,1,_,_],
        [_,_,_,_,1,1,1,1,1,1,1,1,1,1,_,_],
        [_,_,_,_,1,3,3,3,6,3,3,3,3,1,_,_],
        [_,_,_,_,_,1,1,1,1,1,1,1,1,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

SMOKEY_BACON = (
    "smokey_bacon", 131,
    {1: (50, 15, 10, 255),    # dark outline
     2: (160, 50, 40, 255),   # base meat red
     3: (120, 30, 25, 255),   # shadow meat
     4: (200, 80, 60, 255),   # highlight meat
     5: (230, 200, 170, 255), # fat light
     6: (200, 170, 140, 255), # fat mid
     7: (170, 130, 100, 255)},# fat shadow
    # Horizontal bacon strip with fat marbling
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,1,1,1,1,1,1,1,1,1,1,1,1,_,_],
        [_,1,4,4,2,5,5,6,2,4,2,5,6,2,1,_],
        [_,1,4,2,2,6,5,5,2,2,2,6,5,2,1,_],
        [_,1,2,2,5,5,6,2,2,5,5,5,2,3,1,_],
        [_,1,2,5,6,6,2,2,5,6,6,2,2,3,1,_],
        [_,1,2,6,7,2,2,5,6,7,2,2,3,3,1,_],
        [_,1,3,2,2,2,5,6,7,2,2,3,3,3,1,_],
        [_,_,1,1,1,1,1,1,1,1,1,1,1,1,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

HONEY_BREAD = (
    "honey_bread", 132,
    {1: (60, 40, 15, 255),    # dark outline
     2: (190, 140, 50, 255),  # base golden brown
     3: (150, 105, 35, 255),  # shadow brown
     4: (220, 175, 80, 255),  # highlight crust
     5: (240, 200, 100, 255), # top highlight
     6: (230, 180, 30, 255),  # honey drip
     7: (200, 150, 20, 255)}, # honey shadow
    # Rounded loaf with honey drip
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,1,1,1,1,1,1,_,_,_,_,_],
        [_,_,_,_,1,5,5,5,5,4,4,1,_,_,_,_],
        [_,_,_,1,5,4,4,4,4,4,2,2,1,_,_,_],
        [_,_,_,1,4,4,2,2,2,2,2,2,1,_,_,_],
        [_,_,1,4,2,2,2,2,2,2,2,3,3,1,_,_],
        [_,_,1,2,2,2,2,2,2,2,2,3,3,1,_,_],
        [_,_,1,2,2,2,2,2,2,2,3,3,3,1,_,_],
        [_,_,1,2,2,3,2,2,3,2,3,3,3,1,_,_],
        [_,_,_,1,3,3,3,3,3,3,3,3,1,_,_,_],
        [_,_,_,_,1,1,1,1,1,1,1,1,6,1,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,6,7,1,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,1,1,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

MUSHROOM_SOUP = (
    "mushroom_soup", 133,
    {1: (40, 30, 20, 255),    # dark outline
     2: (140, 100, 60, 255),  # bowl brown
     3: (110, 75, 40, 255),   # bowl shadow
     4: (170, 130, 80, 255),  # bowl highlight
     5: (160, 120, 50, 255),  # soup base
     6: (130, 90, 35, 255),   # soup shadow
     7: (180, 140, 80, 255),  # mushroom cap
     8: (210, 190, 160, 255)},# mushroom light / steam
    # Small bowl with soup and mushroom cap
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,8,_,_,8,_,_,_,_,_],
        [_,_,_,_,_,_,8,_,_,8,_,_,_,_,_,_],
        [_,_,_,_,_,1,1,1,1,1,1,_,_,_,_,_],
        [_,_,_,_,1,5,7,8,7,5,6,1,_,_,_,_],
        [_,_,_,1,5,5,1,7,1,5,5,6,1,_,_,_],
        [_,_,1,1,5,5,5,1,5,5,6,6,1,1,_,_],
        [_,_,1,4,1,1,1,1,1,1,1,1,3,1,_,_],
        [_,_,_,1,4,2,2,2,2,2,2,3,1,_,_,_],
        [_,_,_,1,4,2,2,2,2,2,3,3,1,_,_,_],
        [_,_,_,_,1,2,2,2,2,3,3,1,_,_,_,_],
        [_,_,_,_,_,1,3,3,3,3,1,_,_,_,_,_],
        [_,_,_,_,_,_,1,1,1,1,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

DRAGON_PEPPER = (
    "dragon_pepper", 134,
    {1: (60, 15, 10, 255),    # dark outline
     2: (220, 40, 25, 255),   # base red
     3: (170, 25, 15, 255),   # shadow red
     4: (240, 80, 40, 255),   # highlight orange-red
     5: (250, 140, 50, 255),  # hot orange highlight
     6: (50, 100, 30, 255)},  # stem green
    # Curved chili pepper
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,6,6,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,6,6,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,1,1,1,_,_,_,_,_],
        [_,_,_,_,_,_,_,1,5,4,4,1,_,_,_,_],
        [_,_,_,_,_,_,1,4,4,2,2,1,_,_,_,_],
        [_,_,_,_,_,1,4,2,2,2,2,1,_,_,_,_],
        [_,_,_,_,1,4,2,2,2,2,3,1,_,_,_,_],
        [_,_,_,_,1,2,2,2,2,3,3,1,_,_,_,_],
        [_,_,_,1,2,2,2,2,3,3,1,_,_,_,_,_],
        [_,_,_,1,2,2,2,3,3,1,_,_,_,_,_,_],
        [_,_,_,_,1,2,3,3,1,_,_,_,_,_,_,_],
        [_,_,_,_,_,1,1,1,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

FROST_BERRY = (
    "frost_berry", 135,
    {1: (20, 40, 80, 255),    # dark outline
     2: (80, 140, 220, 255),  # base blue
     3: (50, 100, 180, 255),  # shadow blue
     4: (120, 180, 240, 255), # highlight blue
     5: (200, 230, 255, 255), # ice white specular
     6: (160, 210, 250, 255), # frost light
     7: (40, 80, 40, 255)},   # stem green
    # Small berry cluster with icy look
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,7,7,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,7,_,_,7,_,_,_,_,_,_],
        [_,_,_,_,_,1,1,1,_,1,1,1,_,_,_,_],
        [_,_,_,_,1,5,4,2,1,5,4,2,1,_,_,_],
        [_,_,_,_,1,4,2,3,1,4,2,3,1,_,_,_],
        [_,_,_,_,_,1,1,1,_,1,1,1,_,_,_,_],
        [_,_,_,_,_,_,1,1,1,1,_,_,_,_,_,_],
        [_,_,_,_,_,1,5,6,4,2,1,_,_,_,_,_],
        [_,_,_,_,_,1,4,2,2,3,1,_,_,_,_,_],
        [_,_,_,_,_,_,1,1,1,1,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,5,_,5,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

ELVEN_WAYBREAD = (
    "elven_waybread", 136,
    {1: (30, 50, 20, 255),    # dark outline
     2: (80, 140, 50, 255),   # leaf green base
     3: (55, 105, 35, 255),   # leaf shadow
     4: (110, 170, 70, 255),  # leaf highlight
     5: (220, 190, 100, 255), # bread gold
     6: (185, 155, 70, 255),  # bread shadow
     7: (240, 215, 130, 255)},# bread highlight
    # Leaf-wrapped rectangular bread
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,1,1,1,1,1,1,1,1,_,_,_,_],
        [_,_,_,1,4,4,4,4,4,2,2,3,1,_,_,_],
        [_,_,1,4,4,2,2,2,2,2,2,3,3,1,_,_],
        [_,_,1,4,2,1,1,1,1,1,1,2,3,1,_,_],
        [_,_,1,2,1,7,7,5,5,5,6,1,3,1,_,_],
        [_,_,1,2,1,7,5,5,5,5,6,1,3,1,_,_],
        [_,_,1,2,1,5,5,5,5,6,6,1,3,1,_,_],
        [_,_,1,3,1,5,5,6,6,6,6,1,3,1,_,_],
        [_,_,1,3,2,1,1,1,1,1,1,2,3,1,_,_],
        [_,_,_,1,3,3,2,2,2,2,3,3,1,_,_,_],
        [_,_,_,_,1,1,1,1,1,1,1,1,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

PIXIE_DUST_CAKE = (
    "pixie_dust_cake", 137,
    {1: (80, 40, 60, 255),    # dark outline
     2: (220, 180, 200, 255), # frosting pink base
     3: (190, 150, 170, 255), # frosting shadow
     4: (240, 210, 225, 255), # frosting highlight
     5: (180, 130, 90, 255),  # cake base
     6: (150, 105, 70, 255),  # cake shadow
     7: (255, 255, 180, 255), # sparkle yellow
     8: (255, 220, 255, 255)},# sparkle pink-white
    # Small frosted cake with sparkle pixels
    [
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,7,_,_,8,_,_,_,_,_,_],
        [_,_,_,_,_,8,_,_,7,_,_,_,_,_,_,_],
        [_,_,_,_,1,1,1,1,1,1,1,1,_,_,_,_],
        [_,_,_,1,4,4,8,4,4,7,4,2,1,_,_,_],
        [_,_,_,1,4,2,2,7,2,2,8,2,1,_,_,_],
        [_,_,_,1,2,2,2,2,2,2,2,3,1,_,_,_],
        [_,_,_,1,2,3,2,8,2,3,2,3,1,_,_,_],
        [_,_,1,1,1,1,1,1,1,1,1,1,1,1,_,_],
        [_,_,1,5,5,5,5,5,5,5,5,5,6,1,_,_],
        [_,_,1,5,5,5,5,5,5,5,5,6,6,1,_,_],
        [_,_,1,5,5,6,5,5,6,5,6,6,6,1,_,_],
        [_,_,_,1,1,1,1,1,1,1,1,1,1,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
        [_,_,_,_,_,_,_,_,_,_,_,_,_,_,_,_],
    ]
)

FOODS = [
    STALE_RATION, APPLE, CHEESE_WEDGE, SMOKEY_BACON, HONEY_BREAD,
    MUSHROOM_SOUP, DRAGON_PEPPER, FROST_BERRY, ELVEN_WAYBREAD, PIXIE_DUST_CAKE,
]


def create_sprite(name, palette, grid):
    """Render a 16x16 pixel-art sprite from a palette-indexed grid."""
    img = Image.new("RGBA", (TILE_SIZE, TILE_SIZE), (0, 0, 0, 0))
    pixels = img.load()
    for y, row in enumerate(grid):
        for x, val in enumerate(row):
            if val != 0 and val in palette:
                pixels[x, y] = palette[val]
    return img


def main():
    os.makedirs(OUTPUT_DIR, exist_ok=True)

    # Create individual PNGs
    placeholders = {}
    for name, index, palette, grid in FOODS:
        img = create_sprite(name, palette, grid)
        out_path = os.path.join(OUTPUT_DIR, f"{name}.png")
        img.save(out_path)
        placeholders[index] = img
        print(f"  Created {out_path}")

    # Load existing items.png
    items = Image.open(ITEMS_PNG).convert("RGBA")
    old_w, old_h = items.size
    print(f"  Original items.png: {old_w}x{old_h}")

    # We need indices 128-137. Current sheet is 128x256 = 8 cols x 16 rows (128 tiles).
    # Need at least row 16 (index 128-135) and row 17 (index 136-143).
    # That's 18 rows = 288px tall.
    needed_h = (max(idx for _, idx, _, _ in FOODS) // COLS + 1) * TILE_SIZE
    new_h = max(old_h, needed_h)
    if new_h > old_h:
        new_items = Image.new("RGBA", (old_w, new_h), (0, 0, 0, 0))
        new_items.paste(items, (0, 0))
    else:
        new_items = items

    # Place each sprite at its grid position
    for name, index, palette, grid in FOODS:
        col = index % COLS
        row = index // COLS
        x = col * TILE_SIZE
        y = row * TILE_SIZE
        new_items.paste(placeholders[index], (x, y))
        print(f"  Placed {name} at index {index} (row={row}, col={col}, x={x}, y={y})")

    new_items.save(ITEMS_PNG)
    final_w, final_h = new_items.size
    print(f"  Saved items.png: {final_w}x{final_h}")


if __name__ == "__main__":
    main()
