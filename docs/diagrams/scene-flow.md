# Scene Flow Diagram

This document shows the flow between scenes in Amazing Pixel Dungeon.

## Main Scene Flow

```mermaid
flowchart TD
    subgraph Launch
        A[App Start] --> B[PixelDungeon.kt]
        B --> C[TitleScene]
    end

    subgraph MainMenu["Main Menu"]
        C -->|Touch| D[StartScene]
        D -->|Back| C
    end

    subgraph GameStart["Game Start"]
        D -->|Select Class| E{New or Continue?}
        E -->|New Game| F[InterlevelScene<br/>Mode: DESCEND]
        E -->|Continue| G[InterlevelScene<br/>Mode: CONTINUE]
    end

    subgraph Gameplay["Active Gameplay"]
        F --> H[GameScene]
        G --> H
        H -->|Stairs Down| I[InterlevelScene<br/>Mode: DESCEND]
        H -->|Stairs Up| J[InterlevelScene<br/>Mode: ASCEND]
        I --> H
        J --> H
    end

    subgraph GameEnd["Game End"]
        H -->|Hero Dies| K[RankingsScene]
        H -->|Get Amulet| L[AmuletScene]
        L -->|Stay| H
        L -->|Escape| M[InterlevelScene<br/>Mode: ASCEND]
        M -->|Reach Surface| N[SurfaceScene]
        N --> K
    end

    subgraph Secondary["Secondary Screens"]
        C -->|Badges| O[BadgesScene]
        C -->|Rankings| K
        C -->|About| P[AboutScene]
        O -->|Back| C
        K -->|Back| C
        P -->|Back| C
    end

    K -->|Play Again| D
```

## Detailed Scene Descriptions

### TitleScene
**Entry point** - Main menu screen

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚     [PIXEL DUNGEON LOGO]        â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚       Touch to Start            â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚    [Badges]  [Rankings]         â”‚
â”‚             [About]             â”‚
â”‚                                 â”‚
â”‚                v1.0.0           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Transitions**:
- Touch screen â†’ StartScene
- Badges button â†’ BadgesScene
- Rankings button â†’ RankingsScene
- About button â†’ AboutScene

---

### StartScene
**Character selection** - Choose hero and start game

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Back]           [Challenges]  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  [Warrior]     [Mage]           â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”          â”‚
â”‚   â”‚     â”‚      â”‚     â”‚          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                 â”‚
â”‚  [Rogue]       [Huntress]       â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”          â”‚
â”‚   â””â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Class Description      â”‚    â”‚
â”‚  â”‚  Starting Equipment     â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                 â”‚
â”‚        [START GAME]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Transitions**:
- Back â†’ TitleScene
- Select class + Start â†’ InterlevelScene (DESCEND)
- Continue game â†’ InterlevelScene (CONTINUE)

---

### InterlevelScene
**Loading/transition** - Level generation and loading

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚         Descending...           â”‚
â”‚         â•â•â•â•â•â•â•â•â•â•â•             â”‚
â”‚             â–‘â–‘â–‘â–‘â–‘               â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Modes**:
| Mode | Trigger | Action |
|------|---------|--------|
| DESCEND | Stairs down | Generate new level |
| ASCEND | Stairs up | Load previous level |
| CONTINUE | Load game | Restore saved state |
| RESURRECT | Ankh use | Respawn hero |
| RETURN | Lloyd's Beacon | Return to marked spot |
| FALL | Chasm | Generate level + fall damage |

**Transitions**:
- Loading complete â†’ GameScene

---

### GameScene
**Main gameplay** - Dungeon exploration and combat

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ [HP Bar] [Buffs]    Gold: 150   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–“  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–“  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–“  â–“â–“â–“â–“â–“â–“â–“â–“  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–“        @   â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–“  â–“â–“â–“â–“â–“â–“â–“â–“  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–“  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–“  â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”‚  â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Combat Log                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Wait] [Search] [Bag] [Quick]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Windows** (modal overlays):
- WndBag - Inventory
- WndItem - Item details
- WndHero - Character sheet
- WndSettings - Game settings
- WndGame - Pause menu

**Transitions**:
- Stairs down â†’ InterlevelScene (DESCEND)
- Stairs up â†’ InterlevelScene (ASCEND)
- Hero death â†’ RankingsScene
- Get Amulet â†’ AmuletScene

---

### AmuletScene
**Victory choice** - Decision after obtaining Amulet

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚    You finally hold the         â”‚
â”‚    Amulet of Yendor!            â”‚
â”‚                                 â”‚
â”‚    [Image of Amulet]            â”‚
â”‚                                 â”‚
â”‚    What will you do?            â”‚
â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  Escape to Surface  â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  Stay and Explore   â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Transitions**:
- Escape â†’ InterlevelScene (ASCEND chain) â†’ SurfaceScene
- Stay â†’ GameScene (continue playing)

---

### SurfaceScene
**Victory screen** - Successful escape

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                 â”‚
â”‚    â˜€ï¸  The sun rises...          â”‚
â”‚                                 â”‚
â”‚    [Animated scene of hero      â”‚
â”‚     walking toward sunset]      â”‚
â”‚                                 â”‚
â”‚    You escaped the dungeon      â”‚
â”‚    with the Amulet of Yendor!   â”‚
â”‚                                 â”‚
â”‚    Final Score: 125,000         â”‚
â”‚                                 â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚  Continue           â”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Transitions**:
- Continue â†’ RankingsScene

---

### RankingsScene
**High scores** - Leaderboard display

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Back]         Rankings        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  #1  125,000  Warrior  Victory  â”‚
â”‚  #2   98,500  Mage     Floor 24 â”‚
â”‚  #3   76,200  Rogue    Floor 20 â”‚
â”‚  #4   54,100  Huntress Floor 15 â”‚
â”‚  #5   32,400  Warrior  Floor 10 â”‚
â”‚  #6   21,300  Mage     Floor 8  â”‚
â”‚  #7   15,200  Rogue    Floor 6  â”‚
â”‚  #8    9,800  Warrior  Floor 4  â”‚
â”‚  #9    5,400  Huntress Floor 3  â”‚
â”‚  #10   2,100  Mage     Floor 1  â”‚
â”‚                                 â”‚
â”‚                                 â”‚
â”‚        [Play Again]             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Transitions**:
- Back â†’ TitleScene
- Play Again â†’ StartScene

---

### BadgesScene
**Achievements** - Badge collection display

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Back]          Badges         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚  [ğŸ†] [ğŸ†] [ğŸ”’] [ğŸ”’] [ğŸ”’] [ğŸ”’]  â”‚
â”‚                                 â”‚
â”‚  [ğŸ†] [ğŸ”’] [ğŸ”’] [ğŸ”’] [ğŸ”’] [ğŸ”’]  â”‚
â”‚                                 â”‚
â”‚  [ğŸ”’] [ğŸ”’] [ğŸ”’] [ğŸ”’] [ğŸ”’] [ğŸ”’]  â”‚
â”‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  First Blood            â”‚    â”‚
â”‚  â”‚  Kill 10 enemies        â”‚    â”‚
â”‚  â”‚  [Unlocked]             â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Transitions**:
- Back â†’ TitleScene
- Select badge â†’ WndBadge (info popup)

---

### AboutScene
**Credits** - Game information

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  [Back]           About         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                 â”‚
â”‚    Amazing Pixel Dungeon        â”‚
â”‚    Version 1.0.0                â”‚
â”‚                                 â”‚
â”‚    Based on Pixel Dungeon       â”‚
â”‚    by Watabou                   â”‚
â”‚                                 â”‚
â”‚    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€        â”‚
â”‚                                 â”‚
â”‚    Code & samples:              â”‚
â”‚    [Links]                      â”‚
â”‚                                 â”‚
â”‚    Graphics:                    â”‚
â”‚    [Credits]                    â”‚
â”‚                                 â”‚
â”‚    Music:                       â”‚
â”‚    [Credits]                    â”‚
â”‚                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Transitions**:
- Back â†’ TitleScene

---

## State Machine Summary

```
                                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚  About   â”‚
                         â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Launch â”‚â”€â”€â”€â–ºâ”‚   Title     â”‚â”€â”€â”€â–ºâ”‚  Badges  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚    Start    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜               â”‚
                     â”‚                      â”‚
                     â–¼                      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
              â”‚ Interlevel  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”      â”‚
              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜        â”‚      â”‚
                     â”‚               â”‚      â”‚
                     â–¼               â”‚      â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚      â”‚
         â”Œâ”€â”€â”€â–ºâ”‚    Game     â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
         â”‚    â””â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”˜               â”‚
         â”‚      â”‚         â”‚                 â”‚
         â”‚      â–¼         â–¼                 â”‚
         â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
         â””â”€â”¤ Amulet â”‚ â”‚Rankingsâ”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚          â–²
                â–¼          â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
           â”‚Surface â”‚â”€â”€â”€â”€â”€â”€â”˜
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## See Also

- [Scene System](../systems/scene-system.md) - Detailed scene implementation
- [Class Hierarchy](class-hierarchy.md) - Scene class hierarchy
- [Game Loop](game-loop.md) - Frame update cycle
